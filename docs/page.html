<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD-File</title>
    <link rel="stylesheet" href="standard.css" id="themeStyle">
    <link rel="stylesheet" href="katex/katex.min.css">
</head>
<body>
    <div class="header">
        <h1><strong>Title</strong></h1>
        <nav>
            <a href="../index.html">Home</a>
            <a href="https://github.com/thhaase">GitHub</a>
            <a href="#" id="themeSwitcher">Switch Theme</a>
            <button onclick="window.print();" class="nav-button">Print</button>
        </nav>
    </div>

    <div id="pageContent"></div>

    <!-- Include the Markdown parser -->
    <script src="markdownParser.js"></script>
    
    <!-- Katex scripts -->
    <script src="katex/katex.min.js"></script>
    <script src="katex/contrib/auto-render.min.js"></script>

    <script>
      // Theme switcher logic
      function changeTheme() {
        var themeStyle = document.getElementById('themeStyle');
        var newTheme = themeStyle.getAttribute('href') === 'standard.css' ? 'second.css' : 'standard.css';
        themeStyle.setAttribute('href', newTheme);
        sessionStorage.setItem('theme', newTheme);
      }

      document.getElementById('themeSwitcher').addEventListener('click', function(e) {
        e.preventDefault();
        changeTheme();
      });

      // Render Katex after markdown is rendered and apply stored theme
      document.addEventListener("DOMContentLoaded", function() {
        var savedTheme = sessionStorage.getItem('theme');
        if (savedTheme) {
          document.getElementById('themeStyle').setAttribute('href', savedTheme);
        }

        const queryParams = new URLSearchParams(window.location.search);
        const pageName = queryParams.get('name');

        if (pageName) {
          fetch(`../${pageName}.md`)
            .then(response => response.text())
            .then(text => {
              const contentElement = document.getElementById('pageContent');
              contentElement.innerHTML = parseMarkdown(text);
              renderMathInElement(contentElement, {
                delimiters: [
                  {left: "$$", right: "$$", display: true},
                  {left: "\\[", right: "\\]", display: true},
                  {left: "$", right: "$", display: false},
                  {left: "\\(", right: "\\)", display: false}
                ],
                ignoredTags: ["script", "noscript", "style", "textarea", "pre", "code"]
              });
            })
            .catch(error => console.error('Error loading markdown:', error));
        } else {
          document.getElementById('pageContent').innerHTML = '<p>Page not found.</p>';
        }

        document.body.addEventListener('click', function(e) {
          if (e.target.tagName === 'A' && e.target.href.endsWith('.md')) {
            e.preventDefault();
            const mdFileName = e.target.getAttribute('href');
            const newPageName = mdFileName.replace('.md', '');
            window.location.href = `page.html?name=${newPageName}`;
          }
        });
      });
    </script>

</body>
</html>
